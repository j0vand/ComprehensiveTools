<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>腰突康复训练</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/modal.css">
</head>
<body>
    <!-- 如果JavaScript被禁用，显示提示 -->
    <noscript>
        <div style="position: fixed; top: 0; left: 0; right: 0; background: #dc3545; color: white; padding: 20px; text-align: center; z-index: 99999; font-size: 16px;">
            ⚠️ 此应用需要JavaScript才能运行！<br>
            请启用浏览器的JavaScript功能。
        </div>
    </noscript>
    
    <!-- 主界面 -->
    <div id="mainView" class="container py-4">
        <!-- 顶部导航 -->
        <header class="mb-4">
            <h1 class="text-center mb-3">
                <i class="bi bi-heart-pulse text-danger"></i>
                腰突康复训练
            </h1>
            <!-- 语音支持状态 -->
            <div id="voiceStatusBar" class="alert alert-info mb-0 text-center" style="display: none;">
                <i class="bi bi-info-circle"></i>
                <span id="voiceStatusText">检测中...</span>
            </div>
        </header>

        <!-- 计划选择区 -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row align-items-center mb-3">
                    <div class="col-8">
                        <label for="planSelect" class="form-label mb-2">当前计划</label>
                        <select id="planSelect" class="form-select">
                            <option value="">请选择训练计划</option>
                        </select>
                    </div>
                    <div class="col-4 text-end">
                        <button id="newPlanBtn" class="btn btn-outline-primary btn-sm mt-4">
                            <i class="bi bi-plus-circle"></i> 新建计划
                        </button>
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <button id="exportBtn" class="btn btn-outline-success btn-sm w-100">
                            <i class="bi bi-download"></i> 导出数据
                        </button>
                    </div>
                    <div class="col-6">
                        <button id="importBtn" class="btn btn-outline-info btn-sm w-100">
                            <i class="bi bi-upload"></i> 导入数据
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>
            </div>
        </div>

        <!-- 训练项列表 -->
        <div id="exerciseList" class="mb-4">
            <!-- 动态生成训练项卡片 -->
        </div>

        <!-- 空状态提示 -->
        <div id="emptyState" class="text-center py-5" style="display: none;">
            <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
            <p class="text-muted mt-3">还没有训练项，点击下方按钮添加</p>
        </div>

        <!-- 底部操作按钮 -->
        <div class="fixed-bottom-actions">
            <div class="container">
                <div class="row g-2">
                    <div class="col-6">
                        <button id="addExerciseBtn" class="btn btn-outline-primary w-100">
                            <i class="bi bi-plus-lg"></i> 添加训练项
                        </button>
                    </div>
                    <div class="col-6">
                        <button id="startTrainingBtn" class="btn btn-success w-100" disabled>
                            <i class="bi bi-play-fill"></i> 开始训练
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 训练执行界面 -->
    <div id="trainingView" class="container-fluid vh-100 d-flex flex-column" style="display: none;">
        <!-- 顶部进度信息 -->
        <div class="training-header text-center py-3">
            <h2 id="exerciseName" class="mb-2">平板支撑</h2>
            <div class="text-muted">
                <span id="exerciseProgress">第1个/共5个</span>
                <span class="mx-2">|</span>
                <span id="setProgress">第1组/共3组</span>
            </div>
        </div>

        <!-- 中央显示区 -->
        <div class="training-main flex-grow-1 d-flex flex-column align-items-center justify-content-center">
            <!-- 持续时间型显示 -->
            <div id="durationDisplay" style="display: none;">
                <div class="timer-circle mb-3 position-relative">
                    <svg class="progress-ring" width="280" height="280">
                        <circle class="progress-ring-bg" cx="140" cy="140" r="120" />
                        <circle id="progressCircle" class="progress-ring-circle" cx="140" cy="140" r="120" />
                    </svg>
                    <div class="timer-text position-absolute top-50 start-50 translate-middle">
                        <div id="timerDisplay" class="timer-number">30</div>
                        <div class="timer-unit">秒</div>
                    </div>
                </div>
                <div id="statusText" class="status-text text-center">准备中</div>
            </div>

            <!-- 次数型显示 -->
            <div id="repsDisplay" style="display: none;">
                <div class="reps-container text-center">
                    <div id="repsNumber" class="reps-number">10</div>
                    <div class="reps-unit">次</div>
                    <div id="repsStatus" class="reps-status mt-3">请按自己的节奏完成</div>
                </div>
            </div>
        </div>

        <!-- 动作说明 -->
        <div class="exercise-description text-center px-4 py-3">
            <p id="exerciseDescription" class="text-muted mb-0">保持身体成一条直线，收紧核心</p>
        </div>

        <!-- 底部控制按钮 -->
        <div class="training-controls pb-4">
            <div class="container">
                <!-- 持续时间型按钮 -->
                <div id="durationControls" style="display: none;">
                    <div class="d-grid gap-2">
                        <button id="pauseBtn" class="btn btn-warning btn-lg">
                            <i class="bi bi-pause-fill"></i> 暂停
                        </button>
                        <div class="row g-2">
                            <div class="col-6">
                                <button id="skipBtn" class="btn btn-outline-secondary w-100">
                                    <i class="bi bi-skip-forward"></i> 跳过
                                </button>
                            </div>
                            <div class="col-6">
                                <button id="stopBtn" class="btn btn-outline-danger w-100">
                                    <i class="bi bi-stop-fill"></i> 结束
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 次数型按钮 -->
                <div id="repsControls" style="display: none;">
                    <div class="d-grid gap-2">
                        <button id="completeSetBtn" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle-fill"></i> 完成一组
                        </button>
                        <div class="row g-2">
                            <div class="col-6">
                                <button id="skipRepsBtn" class="btn btn-outline-secondary w-100">
                                    <i class="bi bi-skip-forward"></i> 跳过
                                </button>
                            </div>
                            <div class="col-6">
                                <button id="stopRepsBtn" class="btn btn-outline-danger w-100">
                                    <i class="bi bi-stop-fill"></i> 结束
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新建/编辑计划弹窗 -->
    <div class="modal fade" id="planModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="planModalTitle">新建训练计划</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="planForm">
                        <div class="mb-3">
                            <label for="planName" class="form-label">计划名称</label>
                            <input type="text" class="form-control" id="planName" required placeholder="例如：第一阶段">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="savePlanBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑训练项弹窗 -->
    <div class="modal fade" id="exerciseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exerciseModalTitle">添加训练项</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="exerciseForm">
                        <div class="mb-3">
                            <label for="exerciseName" class="form-label">训练项名称</label>
                            <input type="text" class="form-control" id="exerciseNameInput" required placeholder="例如：平板支撑">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">训练类型</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="exerciseType" id="typeDuration" value="duration" checked>
                                <label class="btn btn-outline-primary" for="typeDuration">持续时间型</label>
                                
                                <input type="radio" class="btn-check" name="exerciseType" id="typeReps" value="reps">
                                <label class="btn btn-outline-primary" for="typeReps">次数型</label>
                            </div>
                        </div>

                        <!-- 持续时间型配置 -->
                        <div id="durationConfig">
                            <div class="mb-3">
                                <label for="duration" class="form-label">坚持时间（秒）</label>
                                <input type="number" class="form-control" id="duration" min="1" value="30">
                            </div>
                        </div>

                        <!-- 次数型配置 -->
                        <div id="repsConfig" style="display: none;">
                            <div class="mb-3">
                                <label for="reps" class="form-label">每组次数</label>
                                <input type="number" class="form-control" id="reps" min="1" value="10">
                            </div>
                        </div>

                        <!-- 共同配置 -->
                        <div class="mb-3">
                            <label for="sets" class="form-label">组数</label>
                            <input type="number" class="form-control" id="sets" min="1" value="3">
                        </div>

                        <div class="mb-3">
                            <label for="setRest" class="form-label">组间休息（秒）</label>
                            <input type="number" class="form-control" id="setRest" min="0" value="60">
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">动作说明</label>
                            <textarea class="form-control" id="description" rows="3" placeholder="描述动作要领"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveExerciseBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 确认删除弹窗 -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">确认删除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">确定要删除这个项目吗？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">确定删除</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 检测Bootstrap是否加载
        window.addEventListener('load', function() {
            if (typeof bootstrap === 'undefined') {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#dc3545;color:white;padding:10px;text-align:center;z-index:99999;';
                errorDiv.textContent = '⚠️ Bootstrap资源加载失败，部分功能可能无法使用。请检查网络连接或使用在线环境。';
                document.body.insertBefore(errorDiv, document.body.firstChild);
            }
        });
    </script>
    <script src="js/storage.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/timer.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
