<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∫ìÂ≠òÁÆ°ÁêÜ</title>
    <script src="https://cdn.jsdelivr.net/npm/pinyin-pro@3.18.2/dist/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .search-section {
            background: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary-color);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .search-item:hover {
            background: var(--background-color);
        }

        .search-item .item-name {
            font-weight: 500;
        }

        .search-item .item-pinyin {
            font-size: 12px;
            color: #666;
        }

        .add-button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .add-button:hover {
            background: #45a049;
        }

        .manage-category-button {
            width: 100%;
            padding: 12px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
        }

        .manage-category-button:hover {
            background: #1976D2;
        }

        .inventory-section {
            background: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-filters {
            display: flex;
            gap: 10px;
        }

        .filter-button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            background: var(--background-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-button.active {
            background: var(--primary-color);
            color: white;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .inventory-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .inventory-table tr:hover {
            background: #f5f5f5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .category-suggestions {
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }

        .submit-button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* ÁßªÈô§ËæìÂÖ•Ê°ÜÁöÑ‰∏ä‰∏ãÂæÆË∞ÉÊåâÈíÆ */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-in-stock {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-low-stock {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-out-stock {
            background: #ffebee;
            color: #c62828;
        }

        .category-list {
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .category-info {
            flex: 1;
        }

        .category-name {
            font-weight: 500;
        }

        .category-keywords {
            font-size: 12px;
            color: #666;
        }

        .category-actions {
            display: flex;
            gap: 10px;
        }

        .category-input-group {
            display: flex;
            gap: 10px;
        }

        .category-input-group input {
            flex: 1;
        }

        .category-input-group button {
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #itemName {
            margin-bottom: 5px;
        }

        .search-suggestions {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item:hover {
            background: var(--background-color);
        }

        .suggestion-name {
            font-weight: 500;
        }

        .suggestion-info {
            font-size: 12px;
            color: #666;
        }

        .brand-input-container {
            position: relative;
            margin-bottom: 15px;
        }

        .brand-suggestions {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .brand-suggestion-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .brand-suggestion-item:hover {
            background: var(--background-color);
        }

        .brand-name {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .brand-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .brand-categories {
            color: var(--primary-color);
        }

        .brand-usage {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recent-tag {
            background: var(--primary-color);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
        }

        .brand-products {
            font-size: 12px;
            color: #888;
        }

        .expiry-warning {
            color: #f44336;
            font-size: 12px;
            margin-top: 4px;
        }

        .expiry-status {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }

        .expiry-status.expired {
            background: #ffebee;
            color: #c62828;
        }

        .expiry-status.warning {
            background: #fff3e0;
            color: #ef6c00;
        }

        .expiry-status.good {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .item-expiry {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .avg-price {
            color: #666;
            font-size: 12px;
        }

        .inventory-table td {
            vertical-align: top;
        }

        .inventory-table button {
            margin: 2px;
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: var(--primary-color);
            color: white;
        }

        .inventory-table button:hover {
            opacity: 0.9;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .details-table th,
        .details-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .details-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .item-count {
            color: #666;
            font-size: 12px;
        }

        .details-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-content {
            max-width: 80%;
            width: auto;
        }

        .price-cell {
            min-width: 120px;
        }

        .price-main {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }

        .price-detail {
            margin-top: 4px;
            font-size: 12px;
            color: #666;
        }

        .price-count {
            display: block;
            margin-bottom: 2px;
        }

        .price-range {
            display: block;
            color: #888;
        }

        /* ÁßªÂä®Á´Ø‰ºòÂåñÊ†∑Âºè */
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --header-height: 60px;
            --bottom-bar-height: 50px;
        }

        /* Âü∫Á°ÄÊ†∑Âºè‰ºòÂåñ */
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            padding: var(--safe-area-inset-top) 0 var(--safe-area-inset-bottom) 0;
        }

        /* ÂìçÂ∫îÂºèÂ∏ÉÂ±Ä */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                padding-bottom: calc(var(--bottom-bar-height) + 20px);
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            /* Ë°®Ê†ºÊîπ‰∏∫Âç°ÁâáÂºèÂ∏ÉÂ±Ä */
            .inventory-table {
                display: none; /* ÈöêËóèÂéüË°®Ê†º */
            }

            .inventory-cards {
                display: grid;
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .inventory-card {
                background: white;
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

            .card-header {
                margin-bottom: 12px;
            }

            .card-title-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 4px;
            }

            .card-title {
                font-size: 16px;
                font-weight: 600;
            }

            .card-subtitle {
                font-size: 14px;
                color: #666;
            }

            .card-status {
                font-size: 12px;
                padding: 2px 8px;
                border-radius: 12px;
            }

            .card-info-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }

            .card-info {
                display: flex;
                flex-direction: column;
                flex: 1;
            }

            .card-label {
                font-size: 12px;
                color: #666;
                margin-bottom: 2px;
            }

            .card-value {
                font-size: 14px;
            }

            .card-value.price {
                color: #f57c00;
                font-weight: 500;
            }

            .card-actions {
                display: flex;
                gap: 8px;
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid #eee;
            }

            .card-button {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 4px;
                padding: 8px;
                border: none;
                border-radius: 8px;
                background: var(--primary-color);
                color: white;
                font-size: 14px;
                cursor: pointer;
            }

            /* Â∫ïÈÉ®Â∑•ÂÖ∑Ê†è */
            .bottom-bar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: var(--bottom-bar-height);
                background: var(--card-background);
                display: flex;
                justify-content: space-around;
                align-items: center;
                padding-bottom: var(--safe-area-inset-bottom);
                box-shadow: 0 -2px 10px var(--shadow-color);
                z-index: 100;
            }

            /* Ê®°ÊÄÅÊ°Ü‰ºòÂåñ */
            .modal-content {
                width: 100%;
                max-width: none;
                height: 100%;
                border-radius: 0;
                padding: calc(var(--safe-area-inset-top) + 10px) 10px;
            }

            .modal-header {
                position: sticky;
                top: 0;
                background: var(--card-background);
                z-index: 1;
                padding: 10px 0;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-control {
                height: 44px;
                font-size: 16px;
            }

            /* ÊêúÁ¥¢Âå∫Âüü‰ºòÂåñ */
            .search-section {
                position: sticky;
                top: 0;
                z-index: 90;
                margin: -10px -10px 10px -10px;
                padding: 10px;
                border-radius: 0;
            }

            .search-input {
                height: 44px;
                font-size: 16px;
            }
        }

        /* Á≠õÈÄâÁõ∏ÂÖ≥Ê†∑Âºè */
        .filter-content {
            padding: 15px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-tag {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            background: none;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .filter-actions {
            padding: 15px;
            display: flex;
            gap: 10px;
            position: sticky;
            bottom: 0;
            background: var(--card-background);
            border-top: 1px solid var(--border-color);
        }

        .filter-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .primary-button {
            background: var(--primary-color);
            color: white;
        }

        .secondary-button {
            background: var(--background-color);
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .filter-content {
                padding: 10px;
            }
            
            .filter-tag {
                padding: 8px 16px;
                font-size: 16px;
            }
            
            .filter-actions button {
                padding: 14px;
                font-size: 16px;
            }
        }

        /* Ê∑ªÂä†Êñ∞ÁöÑÊ†∑Âºè */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-color);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 16px;
            color: #666;
        }

        .inventory-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            padding: 16px;
        }

        @media (max-width: 768px) {
            .inventory-cards {
                grid-template-columns: 1fr;
                padding: 10px;
            }
        }

        /* ÁªüËÆ°Áõ∏ÂÖ≥Ê†∑Âºè */
        .stats-content {
            padding: 20px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-background);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .stat-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-subtitle {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .stat-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 12px;
            margin: 0 2px;
        }

        .stat-tag.low-stock {
            background: #fff3e0;
            color: #f57c00;
        }

        .stat-tag.out-stock {
            background: #ffebee;
            color: #d32f2f;
        }

        .stats-section {
            margin-top: 24px;
        }

        .stats-section h3 {
            margin-bottom: 16px;
            font-size: 16px;
            color: var(--text-color);
        }

        .stats-table {
            overflow-x: auto;
        }

        .stats-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-table th {
            font-weight: 600;
            color: #666;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .stats-table {
                margin: 0 -20px;
                padding: 0 20px;
            }
        }

        /* Â§áÊ≥®Áõ∏ÂÖ≥Ê†∑Âºè */
        textarea.form-control {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        .remark-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: help;
        }

        @media (max-width: 768px) {
            .remark-cell {
                max-width: 120px;
            }
            
            textarea.form-control {
                font-size: 16px; /* Èò≤Ê≠¢iOSËá™Âä®Áº©Êîæ */
            }
        }

        /* Êõ¥Êñ∞Âç°ÁâáÊ†∑Âºè */
        .card-content {
            padding: 8px 0;
        }

        .card-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            text-align: center;
        }

        .card-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .card-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .card-value {
            font-size: 16px;
            font-weight: 500;
        }

        .card-value.price {
            color: #f57c00;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
        }

        .card-subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .card-info-grid {
                gap: 8px;
            }

            .card-value {
                font-size: 15px;
            }
        }

        /* ËØ¶ÊÉÖÈ°µÈù¢Ê†∑Âºè */
        .item-info-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 16px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .info-group {
            display: flex;
            flex-direction: column;
        }

        .info-group label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 15px;
            font-weight: 500;
        }

        .info-value.highlight {
            color: var(--primary-color);
        }

        .info-value.price {
            color: #f57c00;
        }

        /* Â§áÊ≥®ÁºñËæëÊ†∑Âºè */
        .info-remark {
            border-top: 1px solid #eee;
            padding-top: 16px;
        }

        .info-remark label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            display: block;
        }

        .remark-content {
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            background: white;
            padding: 8px;
            border-radius: 8px;
            min-height: 60px;
            width: 100%;
            resize: vertical;
        }

        .edit-remark-button {
            margin-top: 8px;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .details-section {
            margin: 16px;
        }

        .details-section h3 {
            font-size: 16px;
            margin-bottom: 12px;
        }

        .details-table-container {
            overflow-x: auto;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
        }

        .details-table th,
        .details-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .details-table th {
            font-weight: 500;
            color: #666;
            background: #f8f9fa;
        }

        .action-button {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            margin-right: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .action-button.delete {
            background: #ffebee;
            color: #d32f2f;
        }

        @media (max-width: 768px) {
            .item-info-card {
                margin: 12px;
                padding: 12px;
            }

            .info-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .details-section {
                margin: 12px;
            }

            .details-table th,
            .details-table td {
                padding: 8px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Â∫ìÂ≠òÁÆ°ÁêÜ</h1>
            <p>ËÆ∞ÂΩïÂíåÁÆ°ÁêÜÊÇ®ÁöÑÁâ©ÂìÅÂ∫ìÂ≠ò</p>
        </div>

        <div class="main-content">
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="ÊêúÁ¥¢ÂïÜÂìÅÔºàÊîØÊåÅÊãºÈü≥È¶ñÂ≠óÊØçÔºâ" oninput="searchItems(this.value)">
                    <div class="search-results" id="searchResults"></div>
                </div>
                <button class="add-button" onclick="showAddModal()">Ê∑ªÂä†Êñ∞ÂïÜÂìÅ</button>
                <button class="manage-category-button" onclick="showCategoryModal()">ÁÆ°ÁêÜÂàÜÁ±ª</button>
            </div>

            <div class="inventory-section">
                <div class="inventory-header">
                    <div class="inventory-filters">
                        <button class="filter-button active" onclick="filterItems('all')">ÂÖ®ÈÉ®</button>
                        <button class="filter-button" onclick="filterItems('in-stock')">Âú®Â∫ì</button>
                        <button class="filter-button" onclick="filterItems('low-stock')">‰ΩéÂ∫ìÂ≠ò</button>
                        <button class="filter-button" onclick="filterItems('out-stock')">Â∑≤Áî®ÂÆå</button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="inventory-cards" id="inventoryList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†ÂïÜÂìÅÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ê∑ªÂä†Êñ∞ÂïÜÂìÅ</h2>
                <button class="close-button" onclick="closeAddModal()">&times;</button>
            </div>
            <form id="addItemForm">
                <div class="form-group">
                    <label for="itemName">ÂïÜÂìÅÂêçÁß∞</label>
                    <input type="text" id="itemName" class="form-control" required oninput="suggestCategory(this.value)">
                </div>
                <div class="form-group">
                    <label for="itemCategory">ÂàÜÁ±ª</label>
                    <select id="itemCategory" class="form-control" required>
                        <option value="">ËØ∑ÈÄâÊã©ÂàÜÁ±ª</option>
                    </select>
                    <div class="category-suggestions" id="categorySuggestions"></div>
                </div>
                <div class="form-group">
                    <label for="itemBrand">ÂìÅÁâå</label>
                    <div class="brand-input-container">
                        <input type="text" id="itemBrand" class="form-control" placeholder="ËæìÂÖ•ÂìÅÁâåÂêçÁß∞">
                        <div class="brand-suggestions" id="brandSuggestions"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="itemSpec">ËßÑÊ†º</label>
                    <input type="text" id="itemSpec" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="itemPrice">‰ª∑Ê†º</label>
                    <input type="number" id="itemPrice" class="form-control" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="itemQuantity">Êï∞Èáè</label>
                    <input type="number" id="itemQuantity" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="itemDate">Ë¥≠‰π∞Êó•Êúü</label>
                    <input type="date" id="itemDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="itemExpiryDate">ËøáÊúüÊó∂Èó¥</label>
                    <input type="date" id="itemExpiryDate" class="form-control">
                    <div class="expiry-warning" id="expiryWarning"></div>
                </div>
                <div class="form-group">
                    <label for="itemRemark">Â§áÊ≥®</label>
                    <textarea id="itemRemark" class="form-control" rows="3"></textarea>
                </div>
                <button type="button" class="submit-button" onclick="addItem()">‰øùÂ≠ò</button>
            </form>
        </div>
    </div>

    <!-- ÂàÜÁ±ªÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÂàÜÁ±ªÁÆ°ÁêÜ</h2>
                <button class="close-button" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="category-list" id="categoryList">
                <!-- ÂàÜÁ±ªÂàóË°®Â∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÁîüÊàê -->
            </div>
            <div class="add-category-form">
                <div class="form-group">
                    <label for="newCategory">Êñ∞Â¢ûÂàÜÁ±ª</label>
                    <div class="category-input-group">
                        <input type="text" id="newCategory" class="form-control" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞">
                        <input type="text" id="categoryKeywords" class="form-control" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØçÔºàÁî®ÈÄóÂè∑ÂàÜÈöîÔºâ">
                        <button onclick="addCategory()">Ê∑ªÂä†</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Â≠òÂÇ®ÊâÄÊúâÂïÜÂìÅÊï∞ÊçÆ
        let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [];
        
        // Â≠òÂÇ®ÂàÜÁ±ªÊï∞ÊçÆ - ‰ΩøÁî®Ê†ëÂΩ¢ÁªìÊûÑ
        let categories = JSON.parse(localStorage.getItem('categories')) || {
            'È£üÂìÅ': {
                keywords: ['È£üÂìÅ', 'Èõ∂È£ü', 'È•ÆÊñô'],
                children: {
                    'Èõ∂È£ü': {
                        keywords: ['È•ºÂπ≤', 'Á≥ñÊûú', 'Â∑ßÂÖãÂäõ'],
                        children: {
                            'È•ºÂπ≤': {
                                keywords: ['Êõ≤Â•á', 'Â®ÅÂåñ'],
                                children: {}
                            }
                        }
                    },
                    'È•ÆÊñô': {
                        keywords: ['ÂíñÂï°', 'Ëå∂', 'ÊûúÊ±Å'],
                        children: {}
                    }
                }
            },
            'Êó•Áî®ÂìÅ': {
                keywords: ['Êó•Áî®', 'Ê∏ÖÊ¥Å'],
                children: {
                    '‰∏™‰∫∫Êä§ÁêÜ': {
                        keywords: ['ÁâôËÜè', 'ÁâôÂà∑', 'ÊØõÂ∑æ'],
                        children: {}
                    },
                    'Ê∏ÖÊ¥ÅÁî®ÂìÅ': {
                        keywords: ['Ê¥óË°£Ê∂≤', 'Ê¥óÊâãÊ∂≤', 'Ê∂àÊØí'],
                        children: {}
                    }
                }
            }
        };
        
        // ÂïÜÂìÅÂêçÁß∞Á¥¢ÂºïÔºåÁî®‰∫éÊêúÁ¥¢
        let nameIndex = new Map();

        // ÂìÅÁâåÊï∞ÊçÆ
        let brandData = JSON.parse(localStorage.getItem('brandData')) || {
            brands: {},  // ÂìÅÁâå‰ΩøÁî®Ê¨°Êï∞ÁªüËÆ°
            recentBrands: []  // ÊúÄËøë‰ΩøÁî®ÁöÑÁâå
        };

        // ÂìÅÁâåÁ¥¢ÂºïÔºåÁî®‰∫éÊêúÁ¥¢ÂíåÂåπÈÖç
        let brandIndex = {
            names: new Map(),  // ÂìÅÁâåÂêçÁß∞Á¥¢Âºï
            pinyin: new Map(), // ÂìÅÁâåÊãºÈü≥Á¥¢Âºï
            items: new Map()   // ÂìÅÁâåÂÖ≥ËÅîÂïÜÂìÅ
        };

        // ÂàùÂßãÂåñÂêçÁß∞Á¥¢Âºï
        function initNameIndex() {
            nameIndex.clear();
            inventoryData.forEach(item => {
                const pinyin = pinyinPro.pinyin(item.name, { toneType: 'none' });
                const pinyinInitials = pinyin.split(' ').map(word => word[0]).join('');
                
                nameIndex.set(item.name, {
                    pinyin: pinyin.replace(/\s/g, ''),
                    initials: pinyinInitials,
                    item: item
                });
            });
        }

        // ÂàùÂßãÂåñÂìÅÁâåÁ¥¢Âºï
        function initBrandIndex() {
            brandIndex.names.clear();
            brandIndex.pinyin.clear();
            brandIndex.items.clear();

            inventoryData.forEach(item => {
                if (item.brand) {
                    const brand = item.brand;
                    const pinyin = pinyinPro.pinyin(brand, { toneType: 'none' });
                    const pinyinInitials = pinyin.split(' ').map(word => word[0]).join('');

                    // Êõ¥Êñ∞ÂìÅÁâåÂêçÁß∞Á¥¢Âºï
                    if (!brandIndex.names.has(brand)) {
                        brandIndex.names.set(brand, {
                            pinyin: pinyin.replace(/\s/g, ''),
                            initials: pinyinInitials,
                            items: []
                        });
                    }

                    // Êõ¥Êñ∞ÂìÅÁâåÂÖ≥ËÅîÂïÜÂìÅ
                    if (!brandIndex.items.has(brand)) {
                        brandIndex.items.set(brand, []);
                    }
                    brandIndex.items.get(brand).push(item);
                }
            });
        }

        // ÊòæÁ§∫Ê∑ªÂä†Ê®°ÊÄÅÊ°Ü
        function showAddModal() {
            document.getElementById('addModal').style.display = 'block';
            document.getElementById('itemDate').valueAsDate = new Date();
            // ÂàùÂßãÂåñÊ∑ªÂä†Ë°®ÂçïÁöÑÂàÜÁ±ª‰∏ãÊãâÊ°Ü
            updateCategorySelect('itemCategory');
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÁöÑÈÄöÁî®ÂáΩÊï∞
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ÂÖ≥Èó≠Ê∑ªÂä†ÂïÜÂìÅÊ®°ÊÄÅÊ°Ü
        function closeAddModal() {
            closeModal('addModal');
            document.getElementById('addItemForm').reset();
        }

        // ÂÖ≥Èó≠ÁºñËæëÊ®°ÊÄÅÊ°Ü
        function closeEditModal() {
            closeModal('editModal');
            document.getElementById('editItemForm').reset();
        }

        // ÂÖ≥Èó≠ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü
        function closeDetailsModal() {
            closeModal('detailsModal');
        }

        // Ê∑ªÂä† ESC ÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÂäüËÉΩ
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAddModal();
                closeEditModal();
                closeDetailsModal();
            }
        });

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeAddModal();
                closeEditModal();
                closeDetailsModal();
            }
        };

        // ÊòæÁ§∫ÂàÜÁ±ªÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü
        function showCategoryModal() {
            document.getElementById('categoryModal').style.display = 'block';
            updateCategoryList();
        }

        // ÂÖ≥Èó≠ÂàÜÁ±ªÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü
        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
        }

        // Ê∑ªÂä†Êñ∞ÂïÜÂìÅ
        function addItem() {
            console.log('addItem ÂáΩÊï∞Ë¢´Ë∞ÉÁî®'); // Ë∞ÉËØïÊó•Âøó

            const name = document.getElementById('itemName').value.trim();
            const category = document.getElementById('itemCategory').value;
            const brand = document.getElementById('itemBrand').value.trim();
            const spec = document.getElementById('itemSpec').value.trim();
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 0;
            const purchaseDate = document.getElementById('itemDate').value;
            const expiryDate = document.getElementById('itemExpiryDate').value;
            const remark = document.getElementById('itemRemark').value.trim();
            
            console.log('Êî∂ÈõÜÁöÑË°®ÂçïÊï∞ÊçÆ:', { name, category, brand, spec, price, quantity, purchaseDate, expiryDate, remark }); // Ë∞ÉËØïÊó•Âøó

            if (!name || !category || quantity <= 0) {
                alert('ËØ∑Â°´ÂÜôÂøÖË¶ÅÁöÑ‰ø°ÊÅØÔºöÂïÜÂìÅÂêçÁß∞„ÄÅÂàÜÁ±ªÂíåÊï∞Èáè');
                return;
            }

            const newItem = {
                id: Date.now(),
                name,
                category,
                brand,
                spec,
                price,
                quantity,
                purchaseDate,
                expiryDate,
                remark,
                createTime: new Date().toISOString(),
                status: quantity > 2 ? 'in-stock' : quantity > 0 ? 'low-stock' : 'out-stock'
            };
            
            console.log('ÂáÜÂ§áÊ∑ªÂä†ÁöÑÊñ∞ÂïÜÂìÅ:', newItem); // Ë∞ÉËØïÊó•Âøó

            // Á°Æ‰øù inventoryData ÊòØÊï∞ÁªÑ
            if (!Array.isArray(inventoryData)) {
                inventoryData = [];
            }
            
            // Ê∑ªÂä†Êñ∞ÂïÜÂìÅ
            inventoryData.push(newItem);
            
            // ‰øùÂ≠òÂà∞ localStorage
            try {
                localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
                console.log('Êï∞ÊçÆ‰øùÂ≠òÊàêÂäü'); // Ë∞ÉËØïÊó•Âøó
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
                alert('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                return;
            }
            
            // Êõ¥È°µÈù¢ÊòæÁ§∫
            updateInventoryList();
            
            // Êõ¥Êñ∞ÂìÅÁâå‰ΩøÁî®ÁªüËÆ°
            if (brand) {
                updateBrandUsage(brand);
            }
            
            // Ê∏ÖÁ©∫Ë°®ÂçïÂπ∂ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            document.getElementById('addItemForm').reset();
            closeAddModal();
            
            console.log('ÂïÜÂìÅÊ∑ªÂä†ÂÆåÊàê'); // Ë∞ÉËØïÊó•Âøó
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞ localStorage
        function saveData() {
            try {
                localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
                initNameIndex();
                initBrandIndex();
                console.log('Êï∞ÊçÆ‰øùÂ≠òÊàêÂäü'); // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // Êõ¥Êñ∞Â∫ìÂ≠òÂàóË°®ÊòæÁ§∫ÔºàÂéªÊéâÂàÜÁ±ªÔºâ
        function updateInventoryList() {
            let container = document.getElementById('inventoryContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'inventoryContainer';
                document.querySelector('.main-content').appendChild(container);
            }
            container.innerHTML = '';

            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'inventory-cards';

            // ÊåâÂïÜÂìÅÂêçÁß∞ÂíåÂûãÂè∑ÂàÜÁªÑ
            const groupedItems = {};
            inventoryData.forEach(item => {
                const key = `${item.name}-${item.spec}`; // ‰ΩøÁî®ÂêçÁß∞ÂíåÂûãÂè∑‰Ωú‰∏∫ÂîØ‰∏ÄÊ†áËØÜ
                if (!groupedItems[key]) {
                    groupedItems[key] = {
                        name: item.name,
                        spec: item.spec,
                        brand: item.brand,
                        totalQuantity: 0,
                        totalValue: 0,
                        count: 0,
                        minPrice: Infinity,
                        maxPrice: -Infinity,
                        earliestExpiry: null
                    };
                }
                
                const group = groupedItems[key];
                const quantity = parseInt(item.quantity) || 0;
                const price = parseFloat(item.price) || 0;
                
                group.totalQuantity += quantity;
                group.totalValue += quantity * price;
                group.count++;
                group.minPrice = Math.min(group.minPrice, price);
                group.maxPrice = Math.max(group.maxPrice, price);
                
                if (item.expiryDate) {
                    if (!group.earliestExpiry || new Date(item.expiryDate) < new Date(group.earliestExpiry)) {
                        group.earliestExpiry = item.expiryDate;
                    }
                }
            });

            // Ê∏≤ÊüìÁÆÄÂåñÁöÑÂïÜÂìÅÂç°Áâá
            Object.values(groupedItems).forEach(group => {
                const avgPrice = group.totalValue / group.totalQuantity || 0;
                const status = group.totalQuantity > 2 ? 'in-stock' : 
                              group.totalQuantity > 0 ? 'low-stock' : 'out-stock';

                const card = document.createElement('div');
                card.className = 'inventory-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title-row">
                            <div class="card-title">${group.name}</div>
                            <span class="card-status status-${status}">${getStatusText(status)}</span>
                        </div>
                        <div class="card-subtitle">${group.spec}</div>
                    </div>
                    <div class="card-content">
                        <div class="card-info-grid">
                            <div class="card-info">
                                <span class="card-label">Êï∞Èáè</span>
                                <span class="card-value">${group.totalQuantity}</span>
                            </div>
                            <div class="card-info">
                                <span class="card-label">Âùá‰ª∑</span>
                                <span class="card-value price">¬•${avgPrice.toFixed(2)}</span>
                            </div>
                            <div class="card-info">
                                <span class="card-label">ÊâπÊ¨°</span>
                                <span class="card-value">${group.count}‰∏™</span>
                            </div>
                        </div>
                        <div class="card-info-grid">
                            <div class="card-info">
                                <span class="card-label">‰ª∑Ê†ºÂå∫Èó¥</span>
                                <span class="card-value">¬•${group.minPrice.toFixed(2)} - ¬•${group.maxPrice.toFixed(2)}</span>
                            </div>
                            <div class="card-info">
                                <span class="card-label">ÊúÄÊó©ËøáÊúü</span>
                                <span class="card-value">${group.earliestExpiry ? formatDate(group.earliestExpiry) : '-'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="card-button" onclick="showItemDetails('${group.name}', '${group.spec}')">
                            <span class="material-icons">info</span>
                            ËØ¶ÊÉÖ
                        </button>
                        <button class="card-button" onclick="addSameItem('${group.name}', '${group.spec}')">
                            <span class="material-icons">add</span>
                            Ê∑ªÂä†
                        </button>
                    </div>
                `;
                cardsContainer.appendChild(card);
            });

            // Â¶ÇÊûúÊ≤°ÊúâÊï∞ÊçÆÊòæÁ§∫ÊèêÁ§∫
            if (Object.keys(groupedItems).length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div class="empty-icon">üì¶</div>
                    <div class="empty-text">Ê≤°ÊúâÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑÂïÜÂìÅ</div>
                `;
                cardsContainer.appendChild(emptyState);
            }

            container.appendChild(cardsContainer);
        }

        // ‰ΩøÁî®ÂïÜÂìÅ
        function useItem(id) {
            const item = inventoryData.find(item => item.id === id);
            if (item) {
                item.quantity--;
                if (item.quantity <= 0) {
                    item.status = 'out-stock';
                } else if (item.quantity <= 2) {
                    item.status = 'low-stock';
                }
                saveData();
                updateInventoryList();
            }
        }

        // Âà†Èô§ÂïÜÂìÅ
        function deleteItem(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂïÜÂìÅÂêóÔºü')) {
                inventoryData = inventoryData.filter(item => item.id !== id);
                saveData();
                updateInventoryList();
            }
        }

        // ËøáÊª§ÂïÜÂìÅÂàóË°®
        function filterItems(filter) {
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const tbody = document.getElementById('inventoryList');
            tbody.innerHTML = '';

            const filteredItems = inventoryData.filter(item => {
                switch (filter) {
                    case 'in-stock':
                        return item.status === 'in-stock';
                    case 'low-stock':
                        return item.status === 'low-stock';
                    case 'out-stock':
                        return item.status === 'out-stock';
                    default:
                        return true;
                }
            });

            filteredItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>${item.brand}</td>
                    <td>${item.spec}</td>
                    <td>¬•${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>${formatDate(item.purchaseDate)}</td>
                    <td>${item.expiryDate ? formatDate(item.expiryDate) : ''}</td>
                    <td>
                        <span class="status-badge status-${item.status}">
                            ${getStatusText(item.status)}
                        </span>
                        ${item.expiryDate ? `
                            <div class="item-expiry">
                                <span class="expiry-status ${getExpiryStatus(item.expiryDate).class}">
                                    ${getExpiryStatus(item.expiryDate).text}
                                </span>
                            </div>
                        ` : ''}
                    </td>
                    <td>
                        <button onclick="useItem(${item.id})">‰ΩøÁî®</button>
                        <button onclick="deleteItem(${item.id})">Âà†Èô§</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Ê†ºÂºèÂåñÊó•Êúü
        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN');
            } catch (error) {
                return '';
            }
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨
        function getStatusText(status) {
            switch (status) {
                case 'in-stock':
                    return 'Âú®Â∫ì';
                case 'low-stock':
                    return '‰ΩéÂ∫ìÂ≠ò';
                case 'out-stock':
                    return 'Â∑≤Áî®ÂÆå';
                default:
                    return 'Êú™Áü•';
            }
        }

        // Ê£ÄÊü•ËøáÊúüÁä∂ÊÄÅ
        function getExpiryStatus(expiryDate) {
            if (!expiryDate) return null;
            
            const today = new Date();
            const expiry = new Date(expiryDate);
            const daysUntilExpiry = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
            
            if (daysUntilExpiry < 0) {
                return {
                    status: 'expired',
                    text: 'Â∑≤ËøáÊúü',
                    class: 'expired'
                };
            } else if (daysUntilExpiry <= 30) {
                return {
                    status: 'warning',
                    text: `ËøòÊúâ ${daysUntilExpiry} Â§©ËøáÊúü`,
                    class: 'warning'
                };
            } else {
                return {
                    status: 'good',
                    text: `Ë∑ùÁ¶ªËøáÊúüËøòÊúâ ${daysUntilExpiry} Â§©`,
                    class: 'good'
                };
            }
        }

        // ÁõëÂê¨ËøáÊúüÊó∂Èó¥ËæìÂÖ•
        document.getElementById('itemExpiryDate').addEventListener('change', function(e) {
            const expiryDate = e.target.value;
            const warningDiv = document.getElementById('expiryWarning');
            
            if (expiryDate) {
                const status = getExpiryStatus(expiryDate);
                if (status) {
                    warningDiv.textContent = status.text;
                    warningDiv.className = `expiry-warning ${status.class}`;
                }
            } else {
                warningDiv.textContent = '';
            }
        });

        // Ê£ÄÊü•ËøáÊúüË≠¶Âëä
        function checkExpiryWarnings() {
            const nearExpiryItems = inventoryData.filter(item => {
                if (!item.expiryDate) return false;
                const status = getExpiryStatus(item.expiryDate);
                return status.status === 'warning' || status.status === 'expired';
            });

            if (nearExpiryItems.length > 0) {
                const expiredCount = nearExpiryItems.filter(item => 
                    getExpiryStatus(item.expiryDate).status === 'expired'
                ).length;
                
                const warningCount = nearExpiryItems.length - expiredCount;
                
                let message = '';
                if (expiredCount > 0) {
                    message += `Êúâ ${expiredCount} ‰∏™ÂïÜÂìÅÂ∑≤ËøáÊúüÔºÅ`;
                }
                if (warningCount > 0) {
                    message += `${message ? ' ' : ''}Êúâ ${warningCount} ‰∏™ÂïÜÂìÅÂç≥Â∞ÜËøáÊúüÔºÅ`;
                }

                // ÊòæÁ§∫ÈÄöÁü•
                if ("Notification" in window && Notification.permission === "granted") {
                    new Notification("Â∫ìÂ≠òËøáÊúüÊèêÈÜí", { body: message });
                }
            }
        }

        // ËØ∑Ê±ÇÈÄöÁü•ÔøΩÔøΩÈôê
        if ("Notification" in window && Notification.permission !== "denied") {
            Notification.requestPermission();
        }

        // Ê†πÊçÆÂïÜÂìÅÂêçÁß∞Âª∫ËÆÆÂàÜÁ±ª
        function suggestCategory(name) {
            let bestMatch = {
                category: 'ÂÖ∂‰ªñ',
                path: 'ÂÖ∂‰ªñ',
                matchCount: 0
            };

            function checkCategory(categoryData, categoryName, currentPath) {
                const matches = categoryData.keywords.filter(keyword => name.includes(keyword)).length;
                if (matches > bestMatch.matchCount) {
                    bestMatch = {
                        category: categoryName,
                        path: currentPath,
                        matchCount: matches
                    };
                }

                // ÈÄíÂΩíÊ£ÄÊü•Â≠êÂàÜÁ±ª
                Object.entries(categoryData.children).forEach(([childName, childData]) => {
                    const childPath = currentPath ? `${currentPath} > ${childName}` : childName;
                    checkCategory(childData, childName, childPath);
                });
            }

            Object.entries(categories).forEach(([categoryName, categoryData]) => {
                checkCategory(categoryData, categoryName, categoryName);
            });

            document.getElementById('itemCategory').value = bestMatch.path;
            document.getElementById('categorySuggestions').textContent = 
                `Âª∫ËÆÆÂàÜÁ±ªÔºö${bestMatch.path}${bestMatch.matchCount > 0 ? ' (ÂåπÈÖçÂÖ≥ÈîÆËØç)' : ''}`;
        }

        // Êõ¥Êñ∞ÂàÜÁ±ªÂàóË°®ÊòæÁ§∫
        function updateCategoryList(parentCategory = null, level = 0) {
            const categoryList = document.getElementById('categoryList');
            if (level === 0) {
                categoryList.innerHTML = '';
            }

            const categoriesToDisplay = parentCategory ? parentCategory.children : categories;
            
            Object.entries(categoriesToDisplay).forEach(([categoryName, categoryData]) => {
                const div = document.createElement('div');
                div.className = 'category-item';
                div.style.marginLeft = `${level * 20}px`;
                
                div.innerHTML = `
                    <div class="category-info">
                        <div class="category-name">
                            ${categoryName}
                            <button class="add-subcategory-btn" onclick="showAddSubcategoryModal('${getFullPath(categoryName, level)}')">+</button>
                        </div>
                        <div class="category-keywords">ÂÖ≥ÈîÆËØç: ${categoryData.keywords.join(', ')}</div>
                    </div>
                    <div class="category-actions">
                        <button onclick="editCategory('${getFullPath(categoryName, level)}')">ÁºñËæë</button>
                        <button onclick="deleteCategory('${getFullPath(categoryName, level)}')">Âà†Èô§</button>
                    </div>
                `;
                categoryList.appendChild(div);

                // ÈÄíÂΩíÊòæÁ§∫Â≠êÂàÜÁ±ª
                if (Object.keys(categoryData.children).length > 0) {
                    updateCategoryList(categoryData, level + 1);
                }
            });

            // Êõ¥Êñ∞ÂïÜÂìÅÊ∑ªÂä†Ë°®Âçï‰∏≠ÂàÜÁ±ªÈÄâÊã©
            updateCategorySelect();
        }

        // Ëé∑ÂèñÂàÜÁ±ªÁöÑÂÆåÊï¥Ë∑ØÂæÑ
        function getFullPath(categoryName, level) {
            return categoryName;  // ËøôÈáåÈúÄË¶ÅÂÆûÁé∞ÂÆåÊï¥Ë∑ØÂæÑÁöÑËé∑ÂèñÈÄªËæë
        }

        // Êõ¥Êñ∞ÂàÜÁ±ªÈÄâÊã©‰∏ãÊãâÊ°Ü
        function updateCategorySelect(selectId = 'itemCategory') {
            const categorySelect = document.getElementById(selectId);
            categorySelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©ÂàÜÁ±ª</option>';
            
            function addOptions(categories, prefix = '') {
                Object.entries(categories).forEach(([name, data]) => {
                    const fullPath = prefix ? `${prefix} > ${name}` : name;
                    categorySelect.innerHTML += `<option value="${fullPath}">${fullPath}</option>`;
                    
                    // ÈÄíÂΩíÊ∑ªÂä†Â≠êÂàÜ
                    if (data.children) {
                        addOptions(data.children, fullPath);
                    }
                });
            }
            
            addOptions(categories);
        }

        // ÊòæÁ§∫Ê∑ªÂä†Â≠êÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü
        function showAddSubcategoryModal(parentPath) {
            const modal = document.getElementById('categoryModal');
            const form = modal.querySelector('.add-category-form');
            form.innerHTML = `
                <div class="form-group">
                    <label>Ê∑ªÂä†Â≠êÂàÜÁ±ªÂà∞: ${parentPath}</label>
                    <div class="category-input-group">
                        <input type="text" id="newSubcategory" class="form-control" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞">
                        <input type="text" id="subcategoryKeywords" class="form-control" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØçÔºàÁî®ÈÄóÂè∑ÂàÜÈöîÔºâ">
                        <button onclick="addSubcategory('${parentPath}')">Ê∑ªÂä†</button>
                    </div>
                </div>
            `;
            modal.style.display = 'block';
        }

        // Ê∑ªÂä†Â≠êÂàÜÁ±ª
        function addSubcategory(parentPath) {
            const categoryName = document.getElementById('newSubcategory').value.trim();
            const keywords = document.getElementById('subcategoryKeywords').value
                .split(',')
                .map(k => k.trim())
                .filter(k => k);

            if (categoryName && keywords.length > 0) {
                // Ê†πÊçÆÁà∂ÂàÜÁ±ªË∑ØÂæÑÊâæÂà∞Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÊ∑ªÂä†Â≠êÂàÜÁ±ª
                let currentLevel = categories;
                const pathParts = parentPath.split(' > ');
                
                for (const part of pathParts) {
                    currentLevel = currentLevel[part].children;
                }

                currentLevel[categoryName] = {
                    keywords: keywords,
                    children: {}
                };

                saveCategories();
                updateCategoryList();
                
                document.getElementById('newSubcategory').value = '';
                document.getElementById('subcategoryKeywords').value = '';
            }
        }

        // ‰øùÂ≠òÂàÜÁ±ªÊï∞ÊçÆ
        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        // Êõ¥Êñ∞ÂìÅÁâå‰ΩøÁî®ÁªüËÆ°
        function updateBrandUsage(brand) {
            if (!brand) return;
            
            // Êõ¥Êñ∞ÂìÅÁâå‰ΩøÁî®Ê¨°Êï∞
            brandData.brands[brand] = (brandData.brands[brand] || 0) + 1;
            
            // Êõ¥Êñ∞ÊúÄËøë‰ΩøÁî®ÁöÑÂìÅÁâå
            const recentIndex = brandData.recentBrands.indexOf(brand);
            if (recentIndex > -1) {
                brandData.recentBrands.splice(recentIndex, 1);
            }
            brandData.recentBrands.unshift(brand);
            
            // ÈôêÂà∂ÊúÄËøë‰ΩøÁî®ÂìÅÁâåÂàóË°®ÈïøÂ∫¶
            if (brandData.recentBrands.length > 10) {
                brandData.recentBrands.pop();
            }
            
            saveBrandData();
        }

        // ‰øùÂ≠òÂìÅÁâåÊï∞ÊçÆ
        function saveBrandData() {
            localStorage.setItem('brandData', JSON.stringify(brandData));
        }

        // ÊòæÁ§∫ÂìÅÁâåÂª∫ËÆÆ
        document.getElementById('itemBrand').addEventListener('input', function(e) {
            const value = e.target.value.trim();
            const suggestionsDiv = document.getElementById('brandSuggestions');
            
            if (!value) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            const results = new Map();
            const lowerValue = value.toLowerCase();
            const pinyinValue = pinyinPro.pinyin(value, { toneType: 'none' }).replace(/\s/g, '').toLowerCase();

            // ÊêúÁ¥¢Áé∞ÊúâÂìÅÁâå
            brandIndex.names.forEach((indexData, brand) => {
                if (brand.toLowerCase().includes(lowerValue) || 
                    indexData.pinyin.toLowerCase().includes(pinyinValue) || 
                    indexData.initials.toLowerCase().includes(lowerValue)) {
                    
                    const items = brandIndex.items.get(brand) || [];
                    const categories = [...new Set(items.map(item => item.category))];
                    
                    results.set(brand, {
                        brand: brand,
                        items: items,
                        categories: categories,
                        useCount: brandData.brands[brand] || 0,
                        isRecent: brandData.recentBrands.includes(brand)
                    });
                }
            });

            // Êåâ‰ΩøÁî®È¢ëÁéáÂíåÊúÄËøë‰ΩøÁî®ÊéíÂ∫è
            const sortedResults = [...results.values()].sort((a, b) => {
                if (a.isRecent !== b.isRecent) {
                    return a.isRecent ? -1 : 1;
                }
                return b.useCount - a.useCount;
            });

            if (sortedResults.length > 0) {
                suggestionsDiv.innerHTML = sortedResults.map(result => `
                    <div class="brand-suggestion-item" onclick="selectBrand('${result.brand}')">
                        <div class="brand-name">${result.brand}</div>
                        <div class="brand-info">
                            <span class="brand-categories">Â∫îÁî®‰∫é: ${result.categories.join(', ')}</span>
                            <span class="brand-usage">
                                ${result.isRecent ? '<span class="recent-tag">ÊúÄËøë‰ΩøÁî®</span>' : ''}
                                ${result.useCount > 0 ? `‰ΩøÁî®${result.useCount}Ê¨°` : ''}
                            </span>
                        </div>
                        <div class="brand-products">
                            Áõ∏ÂÖ≥ÂïÜÂìÅ: ${result.items.slice(0, 3).map(item => item.name).join(', ')}
                            ${result.items.length > 3 ? ` Á≠â${result.items.length}‰∏™ÂïÜÂìÅ` : ''}
                        </div>
                    </div>
                `).join('');
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });

        // ÈÄâÊã©ÂìÅÁâåÊó∂ÂêåÊó∂Â°´ÂÖÖÂÖ∂‰ªñÁõ∏ÂÖ≥‰ø°ÊÅØ
        function selectBrand(brand) {
            document.getElementById('itemBrand').value = brand;
            document.getElementById('brandSuggestions').style.display = 'none';

            // Ëé∑ÂèñËØ•ÂìÅÁâåÊúÄÂ∏∏Áî®ÁöÑÂàÜÁ±ª
            const items = brandIndex.items.get(brand) || [];
            if (items.length > 0) {
                const categoryCount = {};
                items.forEach(item => {
                    categoryCount[item.category] = (categoryCount[item.category] || 0) + 1;
                });
                
                const mostUsedCategory = Object.entries(categoryCount)
                    .sort((a, b) => b[1] - a[1])[0][0];
                
                // Â¶ÇÊûúÁî®Êà∑ËøòÊ≤°ÊúâÈÄâÊã©ÂàÜÁ±ªÔºåÂ∞±‰ΩøÁî®ÊúÄÂ∏∏Áî®ÁöÑÂàÜÁ±ª
                const currentCategory = document.getElementById('itemCategory').value;
                if (!currentCategory) {
                    document.getElementById('itemCategory').value = mostUsedCategory;
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.onload = function() {
            initNameIndex();
            initBrandIndex();
            updateInventoryList();
            updateCategoryList();
            addBottomBar();
        };

        // ‰øÆÊîπÂïÜÂìÅËØ¶ÊÉÖÊòæÁ§∫ÔºåÂ¢ûÂä†Â§áÊ≥®ÁºñËæëÂäüËÉΩ
        function showItemDetails(itemName, itemSpec) {
            const items = inventoryData.filter(item => item.name === itemName && item.spec === itemSpec);
            if (!items.length) return;

            const firstItem = items[0];
            const totalQuantity = items.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
            const totalValue = items.reduce((sum, item) => sum + ((parseInt(item.quantity) || 0) * (parseFloat(item.price) || 0)), 0);
            const avgPrice = totalValue / totalQuantity || 0;

            const detailsHtml = `
                <div class="modal" id="detailsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${itemName}</h2>
                            <button class="close-button" onclick="closeDetailsModal()">&times;</button>
                        </div>
                        
                        <!-- ÂïÜÂìÅÂü∫Êú¨‰ø°ÊÅØÂç°Áâá -->
                        <div class="item-info-card">
                            <div class="info-grid">
                                <div class="info-group">
                                    <label>ÂûãÂè∑</label>
                                    <div class="info-value">${itemSpec || '-'}</div>
                                </div>
                                <div class="info-group">
                                    <label>ÂàÜÁ±ª</label>
                                    <div class="info-value">${firstItem.category || '-'}</div>
                                </div>
                                <div class="info-group">
                                    <label>ÂìÅÁâå</label>
                                    <div class="info-value">${firstItem.brand || '-'}</div>
                                </div>
                                <div class="info-group">
                                    <label>ÊÄªÊï∞Èáè</label>
                                    <div class="info-value highlight">${totalQuantity}</div>
                                </div>
                                <div class="info-group">
                                    <label>Âπ≥ÂùáÂçï‰ª∑</label>
                                    <div class="info-value price">¬•${avgPrice.toFixed(2)}</div>
                                </div>
                                <div class="info-group">
                                    <label>ÊâπÊ¨°Êï∞</label>
                                    <div class="info-value">${items.length}‰∏™</div>
                                </div>
                            </div>
                            
                            <!-- Â§áÊ≥®‰ø°ÊÅØ -->
                            <div class="info-remark">
                                <label>Â§áÊ≥®</label>
                                <textarea id="remarkTextarea" class="remark-content" rows="3">${firstItem.remark || ''}</textarea>
                                <button class="edit-remark-button" onclick="saveRemark('${firstItem.id}')">‰øùÂ≠òÂ§áÊ≥®</button>
                            </div>
                        </div>

                        <!-- ÊâπÊ¨°ÂàóË°® -->
                        <div class="details-section">
                            <h3>ÊâπÊ¨°ÊòéÁªÜ</h3>
                            <div class="details-table-container">
                                <table class="details-table">
                                    <thead>
                                        <tr>
                                            <th>ÊâπÊ¨°</th>
                                            <th>Êï∞Èáè</th>
                                            <th>Âçï‰ª∑</th>
                                            <th>Ë¥≠‰π∞Êó•Êúü</th>
                                            <th>ËøáÊúüÊó∂Èó¥</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${items.map((item, index) => `
                                            <tr>
                                                <td>#${index + 1}</td>
                                                <td>${item.quantity}</td>
                                                <td>¬•${(parseFloat(item.price) || 0).toFixed(2)}</td>
                                                <td>${formatDate(item.purchaseDate)}</td>
                                                <td>
                                                    ${item.expiryDate ? `
                                                        <span class="expiry-status ${getExpiryStatus(item.expiryDate).class}">
                                                            ${formatDate(item.expiryDate)}
                                                        </span>
                                                    ` : '-'}
                                                </td>
                                                <td>
                                                    <button class="action-button" onclick="showEditModal(${item.id})">ÁºñËæë</button>
                                                    <button class="action-button delete" onclick="deleteItem(${item.id})">Âà†Èô§</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const oldModal = document.getElementById('detailsModal');
            if (oldModal) {
                oldModal.remove();
            }

            document.body.insertAdjacentHTML('beforeend', detailsHtml);
            document.getElementById('detailsModal').style.display = 'block';
        }

        // ‰øùÂ≠òÂ§áÊ≥®
        function saveRemark(itemId) {
            const remark = document.getElementById('remarkTextarea').value.trim();
            const item = inventoryData.find(item => item.id === itemId);
            if (item) {
                item.remark = remark;
                alert('Â§áÊ≥®Â∑≤‰øùÂ≠ò');
            }
        }

        // Âø´ÈÄüÊ∑ªÂä†Áõ∏ÂêåÂïÜÂìÅ
        function addSameItem(itemName, itemSpec) {
            const existingItem = inventoryData.find(item => item.name === itemName && item.spec === itemSpec);
            if (!existingItem) return;

            // È¢ÑÂ°´ÂÖÖË°®Âçï
            document.getElementById('itemName').value = existingItem.name;
            document.getElementById('itemCategory').value = existingItem.category;
            document.getElementById('itemBrand').value = existingItem.brand;
            document.getElementById('itemSpec').value = existingItem.spec;
            document.getElementById('itemPrice').value = existingItem.price;
            document.getElementById('itemDate').valueAsDate = new Date();

            // ÊòæÁ§∫Ê∑ªÂä†Ê®°ÊÄÅÊ°Ü
            showAddModal();
        }

        // ÊòæÁ§∫ÁºñËæëÊ®°ÊÄÅÊ°Ü
        function showEditModal(itemId) {
            const item = inventoryData.find(item => item.id === itemId);
            if (!item) return;

            // ÂàõÂª∫ÁºñËæëÊ®°ÊÄÅÊ°ÜÁöÑHTML
            const editHtml = `
                <div class="modal" id="editModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ÁºñËæëÂïÜÂìÅ</h2>
                            <button class="close-button" onclick="closeEditModal()">&times;</button>
                        </div>
                        <form id="editItemForm" onsubmit="updateItem(event)">
                            <input type="hidden" id="editItemId" value="${item.id}">
                            <div class="form-group">
                                <label for="editItemName">ÂïÜÂìÅÂêçÁß∞</label>
                                <input type="text" id="editItemName" class="form-control" value="${item.name}" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemCategory">ÂàÜÁ±ª</label>
                                <select id="editItemCategory" class="form-control" required>
                                    <option value="">ËØ∑ÈÄâÊã©ÂàÜÁ±ª</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editItemBrand">ÂìÅÁâå</label>
                                <input type="text" id="editItemBrand" class="form-control" value="${item.brand || ''}">
                            </div>
                            <div class="form-group">
                                <label for="editItemSpec">ÂûãÂè∑</label>
                                <input type="text" id="editItemSpec" class="form-control" value="${item.spec || ''}" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemPrice">‰ª∑Ê†º</label>
                                <input type="number" id="editItemPrice" class="form-control" step="0.01" min="0" value="${item.price || 0}" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemQuantity">Êï∞Èáè</label>
                                <input type="number" id="editItemQuantity" class="form-control" min="0" value="${item.quantity || 0}" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemDate">Ë¥≠‰π∞Êó•Êúü</label>
                                <input type="date" id="editItemDate" class="form-control" value="${item.purchaseDate}" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemExpiryDate">ËøáÊúüÊó∂Èó¥</label>
                                <input type="date" id="editItemExpiryDate" class="form-control" value="${item.expiryDate || ''}">
                            </div>
                            <div class="form-group">
                                <label for="editItemRemark">Â§áÊ≥®</label>
                                <textarea id="editItemRemark" class="form-control">${item.remark || ''}</textarea>
                            </div>
                            <button type="submit" class="submit-button">‰øùÂ≠ò‰øÆÊîπ</button>
                        </form>
                    </div>
                </div>
            `;

            // ÁßªÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊóßÊ®°ÊÄÅÊ°Ü
            const oldModal = document.getElementById('editModal');
            if (oldModal) {
                oldModal.remove();
            }

            // Ê∑ªÂä†Êñ∞Ê®°ÊÄÅÊ°ÜÂà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', editHtml);
            
            // ÂàùÂßãÂåñÂàÜÁ±ª‰∏ãÊãâÊ°Ü
            updateCategorySelect('editItemCategory');
            
            // ËÆæÁΩÆÂΩìÂâçÂàÜÁ±ª
            document.getElementById('editItemCategory').value = item.category;
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('editModal').style.display = 'block';
        }

        // Êõ¥Êñ∞ÂïÜÂìÅ‰ø°ÊÅØ
        function updateItem(event) {
            event.preventDefault();

            const itemId = parseInt(document.getElementById('editItemId').value);
            const itemIndex = inventoryData.findIndex(item => item.id === itemId);

            if (itemIndex === -1) return;

            const updatedItem = {
                ...inventoryData[itemIndex],
                name: document.getElementById('editItemName').value.trim(),
                category: document.getElementById('editItemCategory').value,
                brand: document.getElementById('editItemBrand').value.trim(),
                spec: document.getElementById('editItemSpec').value.trim(),
                price: parseFloat(document.getElementById('editItemPrice').value) || 0,
                quantity: parseInt(document.getElementById('editItemQuantity').value) || 0,
                purchaseDate: document.getElementById('editItemDate').value,
                expiryDate: document.getElementById('editItemExpiryDate').value || null,
                remark: document.getElementById('editItemRemark').value.trim(),
                status: document.getElementById('editItemQuantity').value > 2 ? 'in-stock' : 
                       document.getElementById('editItemQuantity').value > 0 ? 'low-stock' : 'out-stock'
            };

            inventoryData[itemIndex] = updatedItem;
            
            // ‰øùÂ≠òÊõ¥Êñ∞
            saveData();
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateInventoryList();
            
            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            closeEditModal();
            
            // Â¶ÇÊûúÂú®ËØ¶ÊÉÖÈ°µÈù¢Ôºå‰πüÊõ¥Êñ∞ËØ¶ÊÉÖÊòæÁ§∫
            const detailsModal = document.getElementById('detailsModal');
            if (detailsModal && detailsModal.style.display === 'block') {
                showItemDetails(updatedItem.name, updatedItem.spec);
            }
        }

        // Ê∑ªÂä†Â∫ïÈÉ®Â∑•ÂÖ∑Ê†è
        function addBottomBar() {
            const bottomBar = document.createElement('div');
            bottomBar.className = 'bottom-bar';
            bottomBar.innerHTML = `
                <button onclick="showAddModal()" class="bottom-bar-button">
                    <span class="material-icons">add_circle</span>
                    Ê∑ªÂä†ÂïÜÂìÅ
                </button>
                <button onclick="showFilters()" class="bottom-bar-button">
                    <span class="material-icons">filter_list</span>
                    Á≠õÈÄâ
                </button>
                <button onclick="showStats()" class="bottom-bar-button">
                    <span class="material-icons">analytics</span>
                    ÁªüËÆ°
                </button>
            `;
            document.body.appendChild(bottomBar);
        }

        // ÊêúÁ¥¢ÂíåÁ≠õÈÄâÁõ∏ÂÖ≥ÁöÑÁä∂ÊÄÅ
        const searchState = {
            keyword: '',
            filters: {
                name: '',
                category: '',
                brand: '',
                spec: '',
                status: ''
            }
        };

        // ÊêúÁ¥¢ÂáΩÊï∞
        function searchItems(keyword) {
            searchState.keyword = keyword.trim().toLowerCase();
            updateInventoryList();
        }

        // ÊòæÁ§∫Á≠õÈÄâÈù¢Êùø
        function showFilters() {
            // Êî∂ÈõÜÊâÄÊúâÂèØÁî®ÁöÑÈÄâÈ°π
            const options = {
                category: new Set(),
                brand: new Set(),
                spec: new Set(),
                status: new Set(['in-stock', 'low-stock', 'out-stock'])
            };

            inventoryData.forEach(item => {
                if (item.category) options.category.add(item.category);
                if (item.brand) options.brand.add(item.brand);
                if (item.spec) options.spec.add(item.spec);
            });

            const filterHtml = `
                <div class="modal" id="filterModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Á≠õÈÄâÊù°‰ª∂</h2>
                            <button class="close-button" onclick="closeFilterModal()">&times;</button>
                        </div>
                        <div class="filter-content">
                            <div class="filter-group">
                                <label>ÂïÜÂìÅÂêçÁß∞</label>
                                <input type="text" id="filterName" class="form-control" 
                                       value="${searchState.filters.name}" 
                                       oninput="updateFilter('name', this.value)"
                                       placeholder="ËæìÂÖ•ÂïÜÂìÅÂêçÁß∞">
                            </div>
                            
                            <div class="filter-group">
                                <label>ÂàÜÁ±ª</label>
                                <div class="filter-tags" id="categoryTags">
                                    <button class="filter-tag ${!searchState.filters.category ? 'active' : ''}" 
                                            onclick="updateFilter('category', '')">ÂÖ®ÈÉ®</button>
                                    ${Array.from(options.category).map(cat => `
                                        <button class="filter-tag ${searchState.filters.category === cat ? 'active' : ''}" 
                                                onclick="updateFilter('category', '${cat}')">${cat}</button>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>ÂìÅÁâå</label>
                                <div class="filter-tags" id="brandTags">
                                    <button class="filter-tag ${!searchState.filters.brand ? 'active' : ''}" 
                                            onclick="updateFilter('brand', '')">ÂÖ®ÈÉ®</button>
                                    ${Array.from(options.brand).map(brand => `
                                        <button class="filter-tag ${searchState.filters.brand === brand ? 'active' : ''}" 
                                                onclick="updateFilter('brand', '${brand}')">${brand}</button>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>ËßÑÊ†º</label>
                                <div class="filter-tags" id="specTags">
                                    <button class="filter-tag ${!searchState.filters.spec ? 'active' : ''}" 
                                            onclick="updateFilter('spec', '')">ÂÖ®ÈÉ®</button>
                                    ${Array.from(options.spec).map(spec => `
                                        <button class="filter-tag ${searchState.filters.spec === spec ? 'active' : ''}" 
                                                onclick="updateFilter('spec', '${spec}')">${spec}</button>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label>Áä∂ÊÄÅ</label>
                                <div class="filter-tags" id="statusTags">
                                    <button class="filter-tag ${!searchState.filters.status ? 'active' : ''}" 
                                            onclick="updateFilter('status', '')">ÂÖ®ÈÉ®</button>
                                    <button class="filter-tag ${searchState.filters.status === 'in-stock' ? 'active' : ''}" 
                                            onclick="updateFilter('status', 'in-stock')">Âú®Â∫ì</button>
                                    <button class="filter-tag ${searchState.filters.status === 'low-stock' ? 'active' : ''}" 
                                            onclick="updateFilter('status', 'low-stock')">‰ΩéÂ∫ìÂ≠ò</button>
                                    <button class="filter-tag ${searchState.filters.status === 'out-stock' ? 'active' : ''}" 
                                            onclick="updateFilter('status', 'out-stock')">Â∑≤Áî®ÂÆå</button>
                                </div>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button onclick="clearFilters()" class="secondary-button">Ê∏ÖÈô§Á≠õÈÄâ</button>
                            <button onclick="applyFilters()" class="primary-button">Â∫îÁî®Á≠õÈÄâ</button>
                        </div>
                    </div>
                </div>
            `;

            // ÁßªÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊóßÊ®°Ê°Ü
            const oldModal = document.getElementById('filterModal');
            if (oldModal) {
                oldModal.remove();
            }

            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', filterHtml);
            document.getElementById('filterModal').style.display = 'block';
        }

        // Êõ¥Êñ∞Á≠õÈÄâÊù°‰ª∂
        function updateFilter(type, value) {
            searchState.filters[type] = value;
            updateFilterTags(type);
        }

        // Êõ¥Êñ∞Á≠õÈÄâÊ†áÁ≠æÁä∂ÊÄÅ
        function updateFilterTags(type) {
            const container = document.getElementById(`${type}Tags`);
            if (!container) return;
            
            container.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.toggle('active', 
                    (tag.textContent === 'ÂÖ®ÈÉ®' && !searchState.filters[type]) || 
                    tag.textContent === searchState.filters[type]
                );
            });
        }

        // Ê∏ÖÈô§ÊâÄÊúâÁ≠õÈÄâ
        function clearFilters() {
            Object.keys(searchState.filters).forEach(key => {
                searchState.filters[key] = '';
            });
            searchState.keyword = '';
            updateInventoryList();
            closeFilterModal();
        }

        // Â∫îÁî®Á≠õÈÄâ
        function applyFilters() {
            updateInventoryList();
            closeFilterModal();
        }

        // ÂÖ≥Èó≠Á≠õÈÄâÈù¢Êùø
        function closeFilterModal() {
            const modal = document.getElementById('filterModal');
            if (modal) {
                modal.remove();
            }
        }

        // ÔøΩÔøΩÔøΩÁ§∫ÁªüËÆ°‰ø°ÊÅØ
        function showStats() {
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const stats = calculateStats();
            
            // ÂàõÂª∫ÁªüËÆ°Ê®°ÊÄÅÊ°Ü
            const statsHtml = `
                <div class="modal" id="statsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Â∫ìÂ≠òÁªüËÆ°</h2>
                            <button class="close-button" onclick="closeStatsModal()">&times;</button>
                        </div>
                        <div class="stats-content">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-title">ÂïÜÂìÅÊÄªÊï∞</div>
                                    <div class="stat-value">${stats.totalItems}</div>
                                    <div class="stat-subtitle">ÂÖ± ${stats.totalBatches} ‰∏™ÊâπÊ¨°</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">Â∫ìÂ≠òÁä∂ÊÄÅ</div>
                                    <div class="stat-value">${stats.inStock}</div>
                                    <div class="stat-subtitle">
                                        <span class="stat-tag low-stock">${stats.lowStock} ‰ΩéÂ∫ìÂ≠ò</span>
                                        <span class="stat-tag out-stock">${stats.outStock} Â∑≤Áî®ÂÆå</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">ÊÄªÂ∫ìÂ≠òÈáè</div>
                                    <div class="stat-value">${stats.totalQuantity}</div>
                                    <div class="stat-subtitle">‰ª∂ÂïÜÂìÅ</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-title">Â∫ìÂ≠òÊÄªÂÄº</div>
                                    <div class="stat-value">¬•${stats.totalValue.toFixed(2)}</div>
                                    <div class="stat-subtitle">Âπ≥Âùá ¬•${stats.averagePrice.toFixed(2)}/‰ª∂</div>
                                </div>
                            </div>

                            <div class="stats-section">
                                <h3>ÂàÜÁ±ªÁªüËÆ°</h3>
                                <div class="stats-table">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ÂàÜÁ±ª</th>
                                                <th>ÂïÜÂìÅÊï∞</th>
                                                <th>Â∫ìÂ≠òÈáè</th>
                                                <th>Â∫ìÂ≠òÂÄº</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${Object.entries(stats.categoryStats)
                                                .sort((a, b) => b[1].quantity - a[1].quantity)
                                                .map(([category, data]) => `
                                                    <tr>
                                                        <td>${category}</td>
                                                        <td>${data.items}</td>
                                                        <td>${data.quantity}</td>
                                                        <td>¬•${data.value.toFixed(2)}</td>
                                                    </tr>
                                                `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="stats-section">
                                <h3>ÂìÅÁâåÁªüËÆ°</h3>
                                <div class="stats-table">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ÂìÅÁâå</th>
                                                <th>ÂïÜÂìÅÊï∞</th>
                                                <th>ÔøΩÔøΩÂ≠òÈáè</th>
                                                <th>Â∫ìÂ≠òÂÄº</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${Object.entries(stats.brandStats)
                                                .sort((a, b) => b[1].quantity - a[1].quantity)
                                                .map(([brand, data]) => `
                                                    <tr>
                                                        <td>${brand || 'Êú™Áü•'}</td>
                                                        <td>${data.items}</td>
                                                        <td>${data.quantity}</td>
                                                        <td>¬•${data.value.toFixed(2)}</td>
                                                    </tr>
                                                `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', statsHtml);
            document.getElementById('statsModal').style.display = 'block';
        }

        // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
        function calculateStats() {
            const stats = {
                totalItems: 0,
                totalBatches: inventoryData.length,
                inStock: 0,
                lowStock: 0,
                outStock: 0,
                totalQuantity: 0,
                totalValue: 0,
                categoryStats: {},
                brandStats: {}
            };

            // ÊåâÂïÜÂìÅÂêçÁß∞ÂíåËßÑÊ†ºÂàÜÁªÑ
            const groupedItems = {};
            inventoryData.forEach(item => {
                const key = `${item.name}-${item.spec}`;
                if (!groupedItems[key]) {
                    groupedItems[key] = {
                        items: [],
                        totalQuantity: 0,
                        totalValue: 0
                    };
                }
                
                const quantity = parseInt(item.quantity) || 0;
                const price = parseFloat(item.price) || 0;
                const value = quantity * price;
                
                groupedItems[key].items.push(item);
                groupedItems[key].totalQuantity += quantity;
                groupedItems[key].totalValue += value;
                
                // Êõ¥Êñ∞ÊÄªËÆ°
                stats.totalQuantity += quantity;
                stats.totalValue += value;
                
                // Êõ¥Êñ∞ÂàÜÁ±ªÁªüËÆ°
                if (item.category) {
                    if (!stats.categoryStats[item.category]) {
                        stats.categoryStats[item.category] = { items: 0, quantity: 0, value: 0 };
                    }
                    stats.categoryStats[item.category].quantity += quantity;
                    stats.categoryStats[item.category].value += value;
                }
                
                // Êõ¥Êñ∞ÂìÅÁâåÁªüËÆ°
                if (item.brand) {
                    if (!stats.brandStats[item.brand]) {
                        stats.brandStats[item.brand] = { items: 0, quantity: 0, value: 0 };
                    }
                    stats.brandStats[item.brand].quantity += quantity;
                    stats.brandStats[item.brand].value += value;
                }
            });

            // ËÆ°ÁÆóÂïÜÂìÅÊÄªÊï∞ÂíåÁä∂ÊÄÅ
            Object.values(groupedItems).forEach(group => {
                stats.totalItems++;
                if (group.totalQuantity > 2) stats.inStock++;
                else if (group.totalQuantity > 0) stats.lowStock++;
                else stats.outStock++;
            });

            // ËÆ°ÁÆóÊØè‰∏™ÂàÜÁ±ªÂíåÂìÅÁâåÁöÑÂïÜÂìÅÊï∞
            Object.values(groupedItems).forEach(group => {
                const item = group.items[0];
                if (item.category) {
                    stats.categoryStats[item.category].items++;
                }
                if (item.brand) {
                    stats.brandStats[item.brand].items++;
                }
            });

            // ËÆ°ÁÆóÂπ≥Âùá‰ª∑Ê†º
            stats.averagePrice = stats.totalQuantity > 0 ? stats.totalValue / stats.totalQuantity : 0;

            return stats;
        }

        // ÂÖ≥Èó≠ÁªüËÆ°Ê®°ÊÄÅÊ°Ü
        function closeStatsModal() {
            const modal = document.getElementById('statsModal');
            if (modal) {
                modal.remove();
            }
        }
    </script>
</body>
</html>
