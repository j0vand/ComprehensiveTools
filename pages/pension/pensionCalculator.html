<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>养老金计算器</title>
    <style>
        /* 复用主页的基础样式变量 */
        :root {
            --primary-color: #4CAF50;
            --hover-color: #45a049;
            --background-color: #f5f5f5;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .calculator-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .calculate-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        .calculate-btn:hover {
            background-color: var(--hover-color);
        }

        .result-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            display: none;
        }

        .disclaimer {
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }

        .region-management {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }

        .region-list {
            margin-top: 10px;
        }

        .region-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid #ddd;
            margin-bottom: 8px;
            border-radius: 4px;
            background-color: white;
        }

        .region-item input {
            margin-right: 10px;
            width: 120px !important;
        }

        .region-item input[type="number"] {
            width: 150px !important;
        }

        .secondary-btn {
            background-color: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
        }

        .secondary-btn:hover {
            background-color: #5a6268;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>养老金计算器</h1>
        <form id="pensionForm">
            <div class="form-group">
                <label for="monthlyPayment">每月缴费金额（元）</label>
                <input type="number" id="monthlyPayment" required min="0">
            </div>

            <div class="form-group">
                <label for="workYears">总缴费年限（年）</label>
                <input type="number" id="workYears" required min="0" max="50">
            </div>

            <div class="form-group">
                <label for="region">所在地区</label>
                <select id="region" required>
                    <option value="">请选择或添加地区</option>
                </select>
                <button type="button" id="addRegionBtn" class="secondary-btn">添加新地区</button>
            </div>

            <div class="region-management" style="margin-bottom: 20px;">
                <h3>地区工资管理</h3>
                <div id="regionList" class="region-list">
                    <!-- 地区列表将通过 JavaScript 动态生成 -->
                </div>
            </div>

            <button type="submit" class="calculate-btn">计算养老金</button>
        </form>

        <div id="resultContainer" class="result-container">
            <h2>预估养老金计算结果</h2>
            <p>基础养老金：<span id="basicPension">0</span> 元/月</p>
            <p>个人账户养老金：<span id="personalPension">0</span> 元/月</p>
            <p>预估总养老金：<span id="totalPension">0</span> 元/月</p>
        </div>

        <div class="disclaimer">
            <p>说明：</p>
            <ol>
                <li>本计算器结果仅供参考，实际养老金以社保部门核定为准</li>
                <li>计算采用当前政策，政策调整可能影响实际金额</li>
                <li>未考虑通货膨胀等因素影响</li>
            </ol>
        </div>
    </div>

    <script>
        // 添加表单数据持久化
        function saveFormData() {
            const formData = {
                monthlyPayment: document.getElementById('monthlyPayment').value,
                workYears: document.getElementById('workYears').value,
                region: document.getElementById('region').value
            };
            localStorage.setItem('pensionFormData', JSON.stringify(formData));
        }

        // 恢复表单数据
        function restoreFormData() {
            const savedData = localStorage.getItem('pensionFormData');
            if (savedData) {
                const formData = JSON.parse(savedData);
                document.getElementById('monthlyPayment').value = formData.monthlyPayment || '';
                document.getElementById('workYears').value = formData.workYears || '';
                // region 的恢复需要等待地区列表加载完成后进行
                if (formData.region) {
                    setTimeout(() => {
                        document.getElementById('region').value = formData.region;
                    }, 100);
                }
            }
        }

        // 修改表单提交处理
        document.getElementById('pensionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const monthlyPayment = parseFloat(document.getElementById('monthlyPayment').value);
            const workYears = parseInt(document.getElementById('workYears').value);
            const region = document.getElementById('region').value;

            // 保存表单数据
            saveFormData();

            // 计算养老金
            const result = calculatePension({
                monthlyPayment,
                workYears,
                region
            });

            // 显示结果
            document.getElementById('basicPension').textContent = result.basicPension.toFixed(2);
            document.getElementById('personalPension').textContent = result.personalPension.toFixed(2);
            document.getElementById('totalPension').textContent = result.totalPension.toFixed(2);
            
            document.getElementById('resultContainer').style.display = 'block';
        });

        // 修改计算函数，移除性别相关逻辑
        function calculatePension(data) {
            const averageSalary = getRegionAverageSalary(data.region);
            
            // 计算个人缴费指数
            const personalIndex = data.monthlyPayment / averageSalary;
            
            // 计算基础养老金
            const basicPension = averageSalary * (1 + personalIndex) / 2 * data.workYears * 0.01;
            
            // 计算个人账户养老金
            const accountBalance = data.monthlyPayment * 12 * data.workYears;
            // 使用统一的计发月数 139
            const paymentMonths = 139;
            const personalPension = accountBalance / paymentMonths;
            
            return {
                basicPension,
                personalPension,
                totalPension: basicPension + personalPension
            };
        }

        // 地区数据存储
        let regions = JSON.parse(localStorage.getItem('pensionRegions')) || {};

        // 初始化函数
        function initializeRegions() {
            // 更新选择框
            updateRegionSelect();
            // 显示地区列表
            renderRegionList();
        }

        // 更新地区选择框
        function updateRegionSelect() {
            const select = document.getElementById('region');
            select.innerHTML = '<option value="">请选择或添加地区</option>';
            Object.keys(regions).forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                select.appendChild(option);
            });
        }

        // 渲染地区列表
        function renderRegionList() {
            const regionList = document.getElementById('regionList');
            regionList.innerHTML = '';
            
            Object.entries(regions).forEach(([region, salary]) => {
                const div = document.createElement('div');
                div.className = 'region-item';
                div.innerHTML = `
                    <input type="text" value="${region}" placeholder="地区名称">
                    <input type="number" value="${salary}" placeholder="平均工资">
                    <button class="delete-btn" onclick="deleteRegion('${region}')">删除</button>
                `;
                
                // 添加更事件监听
                const inputs = div.querySelectorAll('input');
                inputs[0].addEventListener('change', (e) => updateRegion(region, e.target.value, salary));
                inputs[1].addEventListener('change', (e) => updateRegion(region, region, Number(e.target.value)));
                
                regionList.appendChild(div);
            });
        }

        // 添加新地区
        document.getElementById('addRegionBtn').addEventListener('click', () => {
            const newRegion = `新地区${Object.keys(regions).length + 1}`;
            regions[newRegion] = 5000; // 默认工资
            saveRegions();
            initializeRegions();
        });

        // 更新地区信息
        function updateRegion(oldRegion, newRegion, salary) {
            if (oldRegion !== newRegion) {
                delete regions[oldRegion];
            }
            regions[newRegion] = salary;
            saveRegions();
            initializeRegions();
        }

        // 删除地区
        function deleteRegion(region) {
            delete regions[region];
            saveRegions();
            initializeRegions();
        }

        // 保存地区数据到 localStorage
        function saveRegions() {
            localStorage.setItem('pensionRegions', JSON.stringify(regions));
        }

        // 修改 getRegionAverageSalary 函数
        function getRegionAverageSalary(region) {
            return regions[region] || 0;
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeRegions();
            restoreFormData();
        });

        // 为表单输入添加实时保存
        ['monthlyPayment', 'workYears', 'region'].forEach(id => {
            document.getElementById(id).addEventListener('change', saveFormData);
        });
    </script>
</body>
</html> 